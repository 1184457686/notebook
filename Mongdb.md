# 基本操作

## 简介

> 基于分布式文件存储数据库(实质就是一个数据库)
>
> C++编写的‘支持的数据结构非常松散，是一个类似`json`的`bason`格式(后期修改数据写`json`格式)
>
> > `JSON` (JavaScript Object Notation,`JS`对象简谱）是一种轻量级的数据交换格式
> > `bson`(二进制`JSON`)

## 启动数据库

> 语法  `mongo`

## 查看数据库

> 语法：show databases

## 选择数据库

> 语法: use 数据库名称
>
> 注意：选择不存在的数据库不会报错，后期数据有数据库是会自动创建
>
> ​		  原因：隐式创建

### 查看集合

> 语法： show collections

### 创建集合

> 语法: `db.createCollection("集合名")`

### 删除集合

> db.集合名.drop()   //删除集合
### 删除数据库
>1、先进入要删除的数据库 use 数据库
>
>2、再删除数据库  `db.dropDatabase()`

# 增 删 查 改

## 增

> 语法：db.集合名.insert(json数据)

## 删

>语法： db.集合名.remove(条件[,是否删除一条])  是否删除一条  默认false(即删除多天)

## 查

> ```
> 基础语法：db.集合名.find({条件}[,查询的列])
> 
> 				注:当没有条件,{}可以不写
> 
> 查询的列(可选)  表示查询出来的集合所显示的列
> db.集合名.find().pretty() 可以格式化查询出来的数据！
> eg:db.c1.find({},{uname:num}) num==1时 表示查询出来得到列表只显示uname，num==0 反之
> 
> 注意：无论[查询的列]怎么写，_id都会显示出来
> ```
>
> ```
> 升级语法 : db.集合名.find({键:{运算符:值}})
> 			eg： 年龄大于5岁  db.c1.find({age:{$t:5}})
> ```
>
> 

## 改

>基础语法：db.集合名.update(条件,新数据[,是否新增，是否修改多条])   默认是覆盖
>
>```
>是否新增:指条件匹配不到数据则插入(true是插入,-false否不插入默认
>是否修改多条:指将匹配成功的数据都修改(true是， false否默认)
>```
>
>```
>升级语法：db.集合名.update(条件,新数据)
>							 {修改器:{key:value}}
>常用修改器: $inc 递增  $rename 重命名列 $set 修改列值  $unset 删除列
>```
>
>

## 注意 

> 留心1:数据库和集合不存在都隐式创建
> 留心2:对象的键统一不加引号方便看，但是查看集合数据时系统会自动加
> 留心3: `mongodb`会给每条数据增加一个全球唯一的_id键

### _id的组成

>  ````
> 0 1 2 3   4 5 6   7 8    9 10 11
>  时间戳	  机器   PID		计数器
>  ````

### 自定义id

> 给插入的JSON数据增加_id键即可覆盖(不推荐)

### 插入多条记录

> ```
> 传递json数组	eg:db.c1.insert([{name:"li",age:13},{name:"wu",age:14}])
> ```
>
> ```
> 如何快速插入10条数据
> 	回答:mongodb底层使用JS引擎实现的，所以支持部分js语法；因此:可以写for循环
> ```
>

# 高级操作

###  排序分页

#### 排序

> 语法: db.集合名.find.sort(Json数据)
> 		键-就是要排序的列/字段、值：1-升序  -1-降序

#### 分页

> 语法 db.集合名.find().sort.skip(数字).limit(数字)
>
> 			skip跳过指定数量(可选)  limit限制查询的数量
>
> 技巧：skip计算公式：(当前页-1)*每页显示条数
>
> 补充： count() 统计总数量

### 聚合查询

> 概念：把数据聚起来，然后统计

> 语法：db.集合名.aggregate([
> {管道:{表达式}}
> ])
>
> > 常用管道:
> > 	$group 将集合中的文档分组，用于统计结果
> > 	$match  过滤数据,只要输出符合条件的文档
> > 	$sort 聚合数据进一步排序
> > 	$skip 跳过指定文档数
> > 	$limit 限制集合数据返回文档流
>
> > 常用表达式
> > $sum 总和 $sum:1同count表示统计
> > $avg 平均
> > $min 最小值
> > $max 最大值
### 优化索引

> 创建索引语法: db.集合名.createindex(带创建索引的列[,额外选项]) 
>
> ​				参数: 带创建索引的列：{键:1,...,键:-1}
>
> ​					说明：1升序 -1降序 例如{age:1}表示创建age索引并按照升序的方式存储
>
> ​					额外选项：设置索引的名称或唯一选项等等

> 删除索引语法
>
> ​	全部删除: db.集合名.dropIndexes()
>
> ​	指定删除  db.集合名.dropIndex(索引名)

> 查看索引  db.集合名.getIndexes()

> 创建唯一索引  db.集合名.createIndex(带添加索引的列,{unique:列名})

### 选择规则(如何选择合适的列创建索引)

-为常做条件、排序、分组的字段建立索引
-选择唯一性索引		(ps.同值较少如性别字段)
-选择较小的数据列，为较长的字符串使用前缀索引(ps.索引文件更小)

### 权限机制

#### 验证模式

> 添加超级管理员
> ```
> use admin
> db .createUser({
> "user" :“账号",
> "pwd":"密码",
> "roles" : [{
> 	role: "角色",
> 	db:"所属数据库"
> 	}]
> })
> ```
> 注意：2.x 3.x 4.x 前面版本看不到admin

> 退出卸载服务 
>
> 进入安装目录下的bin目录执行 mongod --remove   doc窗口管理员窗口

> 安装需要身份验证的mongodb服务
>
> ```
> eg bin\mongod --install --dbpath E:\mongodb\data --logpath E:\mongodb\logs\mongodb2.log --auth
> ```

> 账号登录
>
> 方法一 mongo服务ip地址:端口/数据库名 -u 用户名 -p 密码   默认端口是27017
>
> 方法二 a 先登录 b 选择数据库 c 输入db.auth(用户名,密码)

### 备份还原

#### 备份

> 语法(这个不是mongodb的命令)
> ```
> 导出数据语法 mongodump -h -prot -u -p -d -o
> 	参数说明：-h host 服务器ip地址(一般不写,默认本机)
> 			-port    端口      一般不写 默认27017
> 			-u       user      账号
> 			-p		 PWD       密码
> 			-d		 database  数据库  数据库不写则导出全局
> 			-o		 open      备份到指定目录下
> ```

#### 还原

> 语法
>
> ```
> 还原数据语法 mongorestore -h -prot -u -p -d --drop
> 	参数说明：-h host 服务器ip地址(一般不写,默认本机)
> 			-port    端口      一般不写 默认27017
> 			-u       user      账号
> 			-p		 PWD       密码  
> 			-d		 database  数据库  数据库不写则还原全部数据
> 			--drop   先删除数据库再导入,不写则覆盖 
> ```

# Api接口

## mongoose

> 下载 npm i mongoose 或者 yarn add mongoose

### schema

> 作用：用来约束mongoDB文档数据   (那些字段必须，那些字段可选)

### model

> 一个模型 对应 一个集合
>
> 可以通过模型管理集合中的数据

### 使用

#### 连接数据库

> 查看node.js笔记

#### 接口

> 概念： 一个文件(js\json\php等) 主要响应JSON数据(操作方便、体积小)或xml数据
>
> ​			注意：只要响应json数据 则所有语言都可以操作

> apiDoC
>
> > ```
> > https:/lapidocjs.com/#configuration
> > 步骤一： 先下载模块 后期同构命令基于注释生成文档（仅一次）
> > 步骤二： 在项目根目录创建apidoc.json文件（仅一次
> > 步骤三： 去写接口注释（N次
> > 步骤四： 生成接口文档（N次
> > 	apidoc -i 接口注释文档 -o 接口存放文档
> > ```

#### 使用正则表达式实现数据查询

```
完整语法：{key : {"$regex" : 正则标记, "options" : 选项}}
```

